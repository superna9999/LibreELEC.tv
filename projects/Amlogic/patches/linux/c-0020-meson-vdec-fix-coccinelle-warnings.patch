From 6447c0982bbbba6a314631e21ee662a0ef8f447a Mon Sep 17 00:00:00 2001
From: Maxime Jourdan <mjourdan@baylibre.com>
Date: Tue, 13 Nov 2018 10:12:09 +0100
Subject: [PATCH 20/23] meson: vdec: fix coccinelle warnings

---
 drivers/media/platform/meson/vdec/codec_mpeg12.c | 2 +-
 drivers/media/platform/meson/vdec/esparser.c     | 6 ++----
 drivers/media/platform/meson/vdec/vdec_helpers.c | 2 +-
 3 files changed, 4 insertions(+), 6 deletions(-)

diff --git a/drivers/media/platform/meson/vdec/codec_mpeg12.c b/drivers/media/platform/meson/vdec/codec_mpeg12.c
index 1bd6fb7..d88530a 100644
--- a/drivers/media/platform/meson/vdec/codec_mpeg12.c
+++ b/drivers/media/platform/meson/vdec/codec_mpeg12.c
@@ -146,7 +146,7 @@ static void codec_mpeg12_update_dar(struct amvdec_session *sess)
 		sess->pixelaspect.numerator = 1;
 		sess->pixelaspect.denominator = 1;
 		break;
-	};
+	}
 }
 
 static irqreturn_t codec_mpeg12_threaded_isr(struct amvdec_session *sess)
diff --git a/drivers/media/platform/meson/vdec/esparser.c b/drivers/media/platform/meson/vdec/esparser.c
index 9498812..c3ddc6f 100644
--- a/drivers/media/platform/meson/vdec/esparser.c
+++ b/drivers/media/platform/meson/vdec/esparser.c
@@ -145,13 +145,11 @@ int esparser_queue_eos(struct amvdec_core *core, const u8 *data, u32 len)
 	dma_addr_t eos_paddr;
 	int ret;
 
-	eos_vaddr = dma_alloc_coherent(dev,
-				       len + SEARCH_PATTERN_LEN,
-				       &eos_paddr, GFP_KERNEL);
+	eos_vaddr = dma_zalloc_coherent(dev, len + SEARCH_PATTERN_LEN,
+					&eos_paddr, GFP_KERNEL);
 	if (!eos_vaddr)
 		return -ENOMEM;
 
-	memset(eos_vaddr, 0, len + SEARCH_PATTERN_LEN);
 	memcpy(eos_vaddr, data, len);
 	ret = esparser_write_data(core, eos_paddr, len);
 	dma_free_coherent(dev, len + SEARCH_PATTERN_LEN,
diff --git a/drivers/media/platform/meson/vdec/vdec_helpers.c b/drivers/media/platform/meson/vdec/vdec_helpers.c
index 597925e..bd2d539 100644
--- a/drivers/media/platform/meson/vdec/vdec_helpers.c
+++ b/drivers/media/platform/meson/vdec/vdec_helpers.c
@@ -211,7 +211,7 @@ int amvdec_set_canvases(struct amvdec_session *sess,
 			dev_err(sess->core->dev, "Unsupported pixfmt %08X\n",
 				pixfmt);
 			return -EINVAL;
-		};
+		}
 
 		reg_num_cur++;
 		if (reg_num_cur >= reg_num[reg_base_cur]) {
-- 
2.7.4

